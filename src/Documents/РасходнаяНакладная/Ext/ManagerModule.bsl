#Область ПрограммныйИнтерфейс

// Возвращает выборку товаров документа сгруппированных по Номенклатуре
// Параметры:
//  документСсылка - ДокументСсылка.РасходнаяНакладная
//  выгрузить - Булево - Если Истина результат запроса будет выгружен в `ТаблицуЗначений`
// Возвращаемое значение:
//  - ВыборкаИзРезультатаЗапроса
//  - ТаблицаЗначений
//      * Номенклатура - СправочникСсылка.Номенклатура
//      * Количество - Число
//  - Неопределено - Если таблица не заполнена
Функция ПолучитьТоварыДокумента(Знач документСсылка, Знач выгрузить = Истина) Экспорт
    запросТовары = Новый Запрос;
    запросТовары.УстановитьПараметр("Ссылка", документСсылка);
    запросТовары.Текст =
        "ВЫБРАТЬ
        |	РасходнаяНакладная.Номенклатура КАК Номенклатура,
        |	СУММА(РасходнаяНакладная.Количество) КАК Количество,
        |	СУММА(РасходнаяНакладная.Цена) КАК Цена,
        |	СУММА(РасходнаяНакладная.Сумма) КАК Сумма
        |ИЗ
        |	Документ.РасходнаяНакладная.Товары КАК РасходнаяНакладная
        |ГДЕ
        |	РасходнаяНакладная.Ссылка = &Ссылка
        |
        |СГРУППИРОВАТЬ ПО
        |	РасходнаяНакладная.Номенклатура
        |";

    результатЗапроса = запросТовары.Выполнить();
    Если результатЗапроса.Пустой() Тогда
        Возврат Неопределено;
    КонецЕсли;

    Если выгрузить = Истина Тогда
        Возврат результатЗапроса.Выгрузить();
    Иначе
        Возврат результатЗапроса.Выбрать();
    КонецЕсли;
КонецФункции

#КонецОбласти // ПрограммныйИнтерфейс
